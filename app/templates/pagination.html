{# app/templates/pagination.html (ИСПРАВЛЕННЫЙ) #}
{% macro render_pagination(pagination, endpoint, params={}) %}
  {% if pagination and pagination.pages > 1 %}
  <nav aria-label="Страницы">
    <ul class="pagination justify-content-center">
      {# Кнопка "Назад" #}
      <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
        {# ИСПРАВЛЕНИЕ: Создаем новый словарь params_prev без 'page' #}
        {% set params_prev = params.copy() %}
        {% set _ = params_prev.pop('page', None) %} {# Удаляем 'page', если есть #}
        <a class="page-link" href="{% if pagination.has_prev %}{{ url_for(endpoint, page=pagination.prev_num, **params_prev) }}{% else %}#{% endif %}" aria-label="Previous">
          <span aria-hidden="true">«</span>
        </a>
      </li>
      {# Номера страниц #}
      {%- for page_num_iter in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if page_num_iter %}
          <li class="page-item {% if page_num_iter == pagination.page %}active{% endif %}">
            {# ИСПРАВЛЕНИЕ: Создаем новый словарь params_page без 'page' #}
            {% set params_page = params.copy() %}
            {% set _ = params_page.pop('page', None) %} {# Удаляем 'page', если есть #}
            <a class="page-link" href="{{ url_for(endpoint, page=page_num_iter, **params_page) }}">
              {{ page_num_iter }}
            </a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">...</span></li>
        {% endif %}
      {%- endfor %}
      {# Кнопка "Вперед" #}
      <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
        {# ИСПРАВЛЕНИЕ: Создаем новый словарь params_next без 'page' #}
        {% set params_next = params.copy() %}
        {% set _ = params_next.pop('page', None) %} {# Удаляем 'page', если есть #}
        <a class="page-link" href="{% if pagination.has_next %}{{ url_for(endpoint, page=pagination.next_num, **params_next) }}{% else %}#{% endif %}" aria-label="Next">
          <span aria-hidden="true">»</span>
        </a>
      </li>
    </ul>
  </nav>
  {% endif %}
{% endmacro %}